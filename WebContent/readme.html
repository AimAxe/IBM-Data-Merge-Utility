<http>
<head></head>
<body>
<h1>DragonFly Install Notes</h1>
<h2>Download Pre-requisits</h2>
	<p>These install instructions are provided as a series of commands to execute.</p>
	<p> The scripts assume you are installing on a server named "dragonfly.ibm.com" that is accessable from your client workstation as simply dragonfly in the hosts file.</p>
	<p>The scripts rely on 2 mount points for software:</p>
	<ul>
		<li>/mnt/hgfs/iso - Linux ISO Images
		<li>/mnt/hgfs/dragonfly/ - Dragonfly and Prerequisite Source
	</ul>
	<ul>
		<li>Download the DataTables pre-req at: http://datatables.net/releases/DataTables-1.10.zip (extract into /mnt/hgfs/dragonfly/DataTables-1.10)</li>
		<li>Download the Editor pre-req at: http://editor.datatables.net/download/download?type=php (extract into /mnt/hgfs/dragonfly/Editor-PHP-1.4)</li>
		<li>Download the dragonfly WAR and TAR files - copy the dragonfly.tar file to /mnt/hgfs/dragonfly/ </li>
		<li>If you don't have access to run wget, download the following files and copy them to /mnt/hgfs/dragonfly and adjust the Tomcat install step</li>
		<ul>
			<li>http://apache.mirrors.tds.net/tomcat/tomcat-7/v7.0.59/bin/apache-tomcat-7.0.59.tar.gz</li>
			<li>http://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-5.1.34.tar.gz</li>
		</ul>
	</ul>
	<p> If you will be using the RHEL ISO images for Yum repositories, place the appropriate file in the /mnt/hgfs/iso folder:</p>
	<ul>
		<li>RHEL-7.0-20140507.0-Server-x86_64-dvd1.iso</li>
		<li>RHEL6.5-20131111.0-Server-x86_64-DVD1.iso</li>
	</ul>

<h2>Installed RHEL</h2>
	<table border="1"><tr><th>RHEL 6</th><th>RHEL 7</th></tr><tr><td>
	<h3>VMWare simple install</h3>
	<textarea cols="80" rows="1"></textarea>
		<ul>
		 	<li>Add dirve sharing</li>
		 	<li>Configure network as bridged</li>
		 	<li>Configure as 2GB and 2CPU</li>
		</ul>	
	<h3>Post-Install Configurations</h3>
		<ul>
		 	<li>run "setup" 
		 	<ul><li>Network ID</li>
		 	<li>Host name and domain</li></ul>
		 	<li>Shared Drives (iso and dragonfly)</li>
		 	<li>Disable Firewall </li>
		</ul>
	</td><td>
	<h3>Do not use VMWare simple install</h3>
	<textarea cols="80" rows="1"></textarea>
		<ul>
		 	<li>Selected "Server with GUI" - No optional components</li>
		 	<li>Configured as 2GB and 2CPU</li>
		 	<li>Shared Drives (iso and dragonfly)</li>
		 	<li>Network ID and host name domain</li>
		 	<li>Set root password during startup</li>
		</ul>
	<h3>Post-Install Configurations</h3>
		<ul> 
			<li>Firewall Configuration "Permanant" - public domain</li>
			<ul>
				<li>add http service</li>
				<li>add port 8080</li>
				<li>add White-List Command line:/usr/local/tomcat7/bin/startup.sh</li>
			</ul> 
			<li>Install VMWare Tools</li>
	</ul>

	</table>
	<h3>Disable SE Linux (proglem is in /var/www/html/Editor/php access)</h3> 
		<textarea cols=40 rows=2>
vi /etc/selinux/config
</textarea><br/>
		<textarea cols=40 rows=2>
SELINUX=disabled
</textarea>

	<h3>Setup Yum Repo's</h3>
	<ul>
		<li>Setup Local Yum Repository (if you need it)</li>
		<table><tr><th>Rhel 6</th><th>RHEL 7</th></tr>
		<tr><td>
		<textarea cols="80" rows="13">
cat <<EOF > /etc/yum.repos.d/iso.repo	
[iso64]
name=RHEL6_64ISO
baseurl=file:///mnt/RHEL6_64/
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
EOF
mkdir -p /mnt/RHEL6_64
mount -o loop /mnt/hgfs/iso/RHEL6.5-20131111.0-Server-x86_64-DVD1.iso /mnt/RHEL6_64/
yum clean all	
</textarea></td><td><textarea rows="13" cols="80">
cat <<EOF > /etc/yum.repos.d/iso.repo	
[iso64]
name=RHEL7_64ISO
baseurl=file:///mnt/RHEL7_64/
enabled=1
gpgcheck=1
gpgkey=file:///etc/pki/rpm-gpg/RPM-GPG-KEY-redhat-release
EOF
mkdir -p /mnt/RHEL7_64
mount -o loop /mnt/hgfs/iso/RHEL-7.0-20140507.0-Server-x86_64-dvd1.iso /mnt/RHEL7_64/
yum clean all	
</textarea></td></tr></table>
	</ul>
	<p> This is a good time to take a VMWare Snapshot for baselines</p>

<h2>Install Appache HTTP Server</h2>
	<ul>
		<li>Install and configure Apache</li>
		<table><tr><th>RHEL 6</th><th>RHEL 7</th></tr>
		<tr><td><textarea cols="80" rows="7">
yum install -y httpd
echo "ServerName www.dragonfly.ibm.com:80" >> /etc/httpd/conf/httpd.conf
echo "<html><head></head><body><h1>It Works</h1></body></html>" > /var/www/html/index.html
/sbin/service httpd start
chkconfig httpd on
</textarea>
		</td><td><textarea cols="80" rows="7">
yum install -y httpd
echo "ServerName www.dragonfly.ibm.com:80" >> /etc/httpd/conf/httpd.conf
echo "<html><head></head><body><h1>It Works</h1></body></html>" > /var/www/html/index.html
systemctl start  httpd
systemctl enable httpd
</textarea>
	</td></tr></table>
	</ul>
	<p>You should now be able to visit <a href="http://dragonfly/index.html"  target="_blank">http://dragonfly/index.html</a> and you should get your "It Works!" page</p>
	
<h2>Install and Configure Database and PHP</h2>
	<ul>
		<li>Install and configure MySQL/MariaDB and Php</li>
		<table><tr><th>RHEL 6</th><th>RHEL 7</th></tr>
		<tr><td>
		<textarea cols="80" rows="8">
yum install -y mysql-server
service mysqld start
mysqladmin -u root password drowssap
chkconfig mysqld on
yum install -y php php-mysql
echo "<?php phpinfo(); ?>" > /var/www/html/phpinfo.php
/sbin/service httpd  restart
</textarea></td><td><textarea  cols="80" rows="8">
yum install -y mariadb-server mariadb
systemctl start mariadb
mysqladmin -u root password drowssap
systemctl enable mariadb.service
yum install -y php php-mysql
echo "<?php phpinfo(); ?>" > /var/www/html/phpinfo.php
systemctl restart httpd
</textarea>
		</td></tr></table>
	</ul>
	<p>You should now be able to visit <a href="http://dragonfly/phpinfo.php"  target="_blank">http://dragonfly/phpinfo.php</a> and you should get your "It Works!" page</p>

<h2>Install and Configure Tomcat</h2>
	<ul>
		<li>Install Java, Tomcat and MySQL JDBC Drivers</li>
		<textarea cols="80" rows="13">
yum install -y java 
cd /tmp
wget http://apache.mirrors.tds.net/tomcat/tomcat-7/v7.0.59/bin/apache-tomcat-7.0.59.tar.gz
tar xzf apache-tomcat-7.0.59.tar.gz
mv apache-tomcat-7.0.59 /usr/local/tomcat7
#
cd /tmp
wget http://dev.mysql.com/get/Downloads/Connector-J/mysql-connector-java-5.1.34.tar.gz
tar -xvf mysql-connector-java-5.1.34.tar.gz
cd /tmp/mysql-connector-java-5.1.34
cp mysql-connector-java-5.1.34-bin.jar /usr/local/tomcat7/lib/
/usr/local/tomcat7/bin/startup.sh
</textarea>
		<li>Edit Tomcat users</li>
		<textarea cols="80" rows="2">
vi /usr/local/tomcat7/conf/tomcat-users.xml
</textarea><br/>
		<textarea cols="80" rows="4">
<role rolename="tomcat"/>
<role rolename="manager-gui"/>
<user username="tomcat" password="tomcat" roles="tomcat,manager-gui"/>
		</textarea>				
		<li>Restart Everything</li>
		<textarea cols="80" rows="4">
/usr/local/tomcat7/bin/shutdown.sh
systemctl restart httpd
/usr/local/tomcat7/bin/startup.sh
</textarea>
	</ul>
	<p>Now visit <a href="http://dragonfly:8080" target="_blank">http://dragonfly:8080</a> to verify Tomcat is running</p>

<h2>Install and configure DragonFly Core</h2>
	<h3>Install the War File</h3>
	<ul>
		<li>From the tomcat home screen (dragonfly:8080) Select "Manage"</li>
		<li>Under "Deploy War File" select and delpoy dragonfly.war</li>
	</ul>
	
	<h3>Configure JNDI Data Sources</h3>
	<ul>
		<li>Edit tomcat context.xml file</li>
 		<textarea cols="80" rows="2">
vi /usr/local/tomcat7/conf/context.xml
</textarea>
		<li>Add these values inside the Context tag</li>
 		<textarea cols="80" rows="11">
<Resource auth="Container" 
	driverClassName="com.mysql.jdbc.Driver" 
	maxActive="100" 
	maxIdle="30" 
	maxWait="10000" 
	name="jdbc/dragonflyDB" 
	password="drowssap"
	type="javax.sql.DataSource" 
	url="jdbc:mysql://localhost:3306/dragonfly" 
	username="root"/>
</textarea>
		<li>Untar DragonFly app</li>
		<li>Load the DragonFly database</li>
		<li>Restart Everything</li>
		<textarea cols="80" rows="13">
# Extract Dragonfly War
cd /var/www/html
tar -xvf /mnt/hgfs/dragonfly/dragonfly.tar
#
# Create and Load Database
cd /var/www/html/sql
mysql -pdrowssap < createTemplateDatabase.sql
#
#Restart Everything
/usr/local/tomcat7/bin/shutdown.sh
systemctl restart httpd
/usr/local/tomcat7/bin/startup.sh
</textarea>
	</ul>
	<p>Now visit <a href="http://dragonfly:8080/dragonfly/Merge.html?collection=dragonFly&name=testRoot" target="_blank">http://dragonfly:8080/dragonfly/Merge.html?collection=dragonFly&name=testRoot</a></p>

<h2>Install and configure DragonFly Template Editor Web-UI</h2>
	<h3>Instal Web Application</h3>
	<ul>
		<li>Setup Environment Vars</li>
		<li>Copy files to /tmp - adjust to your share volume</li>
		<li>Extract and arrange files</li>
		<li>Configure Environment Vars</li>
		<textarea cols="80" rows="22">
#
# Configure PHP Environment Vars
cat <<EOF > /etc/httpd/conf.d/dragonfly.conf
SetEnv OPENSHIFT_MYSQL_DB_USERNAME "root"
SetEnv OPENSHIFT_MYSQL_DB_PASSWORD "drowssap"
SetEnv OPENSHIFT_MYSQL_DB_HOST "localhost"
SetEnv OPENSHIFT_MYSQL_DB_PORT "3306"
SetEnv OPENSHIFT_APP_NAME "dragonfly"
SetEnv PHP_LIB_ROOT "/var/www/html"
EOF
#
# Exract and Arrange Files
cd /var/www/html
mkdir Editor
cp -r /mnt/hgfs/dragonfly/Editor-PHP-1.4/* ./Editor/
mkdir -p DataTables
cd DataTables
cp -r /mnt/hgfs/dragonfly/DataTables-1.10/media/* ./
cp -r /mnt/hgfs/dragonfly/DataTables-1.10/extensions/ .
rm -f  /var/www/html/Editor/php/Bootstrap.php
cp    /var/www/html/Bootstrap.php /var/www/html/Editor/php/Bootstrap.php
</textarea>
		<li>Change the Merge URL from "localhost" to your host name</li>
		<textarea cols="80" rows="2">
vi /var/www/html/admin.php
</textarea>
		<li>Restart Everything</li>
		<textarea cols="80" rows="4">
/usr/local/tomcat7/bin/shutdown.sh
systemctl restart httpd
/usr/local/tomcat7/bin/startup.sh
</textarea>
	</ul>
	<p>You can now use the DragonFly Template Editor at <a href="http://dragonfly/admin.php" target="_blank">http://dragonfly/admin.php</a></p>


<h2>Install and configure DragonFly Training Web-UI</h2>
	<h3>Create Testdata jdbc connection</h3>
	<ul>
		<li>Edit tomcat context.xml file</li>
 		<textarea cols="80" rows="2">
vi /usr/local/tomcat7/conf/context.xml
</textarea>
		<li>Add these values inside the Context tag</li>
 		<textarea cols="80" rows="11">
<Resource auth="Container" 
	driverClassName="com.mysql.jdbc.Driver" 
	maxActive="100" 
	maxIdle="30" 
	maxWait="10000" 
	name="jdbc/testgenDB" 
	password="drowssap"
	type="javax.sql.DataSource" 
	url="jdbc:mysql://localhost:3306/testgen" 
	username="root"/>
</textarea>
		<li>Create and load Tables</li>
		<textarea cols="80" rows="4">
# Create and Load Database
cd /var/www/html/sql
mysql -pdrowssap < createSampleDatabase.sql
</textarea>
		<li>Change merge host from "localhost" to your host name</li>
		<textarea cols="80" rows="2">
vi /var/www/html/training.php
</textarea>
		<li>Restart Everything</li>
		<textarea cols="80" rows="4">
/usr/local/tomcat7/bin/shutdown.sh
systemctl restart httpd
/usr/local/tomcat7/bin/startup.sh
</textarea>
	</ul>
	<p>You can now use the DragonFly Training UI at <a href="http://dragonfly/training.php" target="_blank">http://dragonfly/training.php</a></p>

<h2>Install and configure situation generator prototype</h2>
	<p>NOTE: The Situation Generator requires PHP v1.4 or newer. <br/>
	Check the phpinfo page to see your currently running version and upgarde if necessary.</br>
	On RHEL6 the PHP version on the iso images is 5.3.3, if you have access to an updated YUM repository you should be able to insall PHP 5.4. </p>

	<h3>Confiure SitGen Database</h3>
	<ul>
		<li>Configure JNDI Data Sources</li>
		<textarea cols="80" rows="2">
vi /usr/local/tomcat7/conf/context.xml
</textarea>
		<li>Add these values inside the Context tag</li>
		<textarea cols="80" rows="11">
<Resource auth="Container" 
	driverClassName="com.mysql.jdbc.Driver" 
	maxActive="100" 
	maxIdle="30" 
	maxWait="10000" 
	name="jdbc/sitgenDB" 
	password="drowssap"
	type="javax.sql.DataSource" 
	url="jdbc:mysql://localhost:3306/sitgen" 
	username="root"/>
		</textarea>
		<li>Install the Web App and create databases</li>
		<textarea cols="80" rows="16">
# Copy the sitgen tar to /tmp
cd /tmp
cp /mnt/hgfs/dragonfly/sitgen.tar .
#
# Extract the file
cd /var/www/html
mkdir -p sitgen
cd sitgen
tar -xvf /tmp/sitgen.tar
#
# Create and Load database
cd /var/www/html/sitgen/sql
mysql -pdrowssap < createDatabase.sql
mysql -pdrowssap < loadAttributes.sql
mysql -pdrowssap < loadTemplates.sql
</textarea>
		<li>Change the dragonFlyUrl from localhost to your hostname</li>
		<textarea cols="80" rows="3">
vi /var/www/html/sitgen/sitGen.php 
vi /var/www/html/sitgen/sitGenAdmin.php 
</textarea>
	</ul>
	<p>You should now be able to visit:</p>
	<ul>
		<li><a href="http://dragonfly/sitgen/sitGen.php" target="_blank">http://dragonfly/sitgen/sitGen.php</a></li>
		<li><a href="http://dragonfly/sitgen/sitGenAdmin.php" target="_blank">http://dragonfly/sitgen/sitGenAdmin.php</a></li>  
	</ul>
</body>
</html>